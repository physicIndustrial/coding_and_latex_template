{
  "name": "LaTeX + Python + Node20 + Gemini (Codespaces)",
  "image": "mcr.microsoft.com/devcontainers/python:3.12-bookworm",

  "containerEnv": {
    "PIP_DISABLE_PIP_VERSION_CHECK": "1"
  },

  "onCreateCommand": "bash -lc \"set -e; echo '== System packages (TeX) =='; sudo apt-get update; sudo apt-get install -y --no-install-recommends texlive-latex-recommended texlive-latex-extra texlive-xetex texlive-fonts-recommended latexmk biber chktex ca-certificates curl git; sudo apt-get clean; sudo rm -rf /var/lib/apt/lists/*; echo '== Python packages =='; python -m pip install --upgrade pip; pip install --no-cache-dir jupyter ipykernel numpy pandas matplotlib requests rich pytest black ruff; echo '== Install nvm + Node 20 =='; export NVM_DIR=\\\"$HOME/.nvm\\\"; if [ ! -s \\\"$NVM_DIR/nvm.sh\\\" ]; then curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash; fi; . \\\"$NVM_DIR/nvm.sh\\\"; nvm install 20; nvm use 20; npm -v; if ! grep -qs 'nvm.sh' \\\"$HOME/.bashrc\\\"; then echo 'export NVM_DIR=\\\"$HOME/.nvm\\\"' >> \\\"$HOME/.bashrc\\\"; echo '[ -s \\\"$NVM_DIR/nvm.sh\\\" ] && . \\\"$NVM_DIR/nvm.sh\\\"' >> \\\"$HOME/.bashrc\\\"; echo 'nvm use 20 >/dev/null 2>&1 || true' >> \\\"$HOME/.bashrc\\\"; fi; if ! grep -qs 'nvm.sh' \\\"$HOME/.profile\\\"; then echo 'export NVM_DIR=\\\"$HOME/.nvm\\\"' >> \\\"$HOME/.profile\\\"; echo '[ -s \\\"$NVM_DIR/nvm.sh\\\" ] && . \\\"$NVM_DIR/nvm.sh\\\"' >> \\\"$HOME/.profile\\\"; echo 'nvm use 20 >/dev/null 2>&1 || true' >> \\\"$HOME/.profile\\\"; fi; echo '== Install Gemini CLI =='; npm install -g @google/gemini-cli; gemini --version\"",

  "postStartCommand": "bash -lc \"export NVM_DIR=\\\"$HOME/.nvm\\\"; [ -s \\\"$NVM_DIR/nvm.sh\\\" ] && . \\\"$NVM_DIR/nvm.sh\\\"; nvm use 20 >/dev/null 2>&1 || true\"",

  "customizations": {
    "vscode": {
      "extensions": [
        "James-Yu.latex-workshop",

        "ms-python.python",
        "ms-toolsai.jupyter",
        "charliermarsh.ruff",
        "ms-python.black-formatter",

        "esbenp.prettier-vscode",
        "streetsidesoftware.code-spell-checker"
      ],
      "settings": {
        // ----- LaTeX Workshop -----
        "latex-workshop.view.pdf.viewer": "tab",
        "latex-workshop.view.pdf.internal.synctex.keybinding": "double-click",
        "latex-workshop.synctex.afterBuild.enabled": true,
        "latex-workshop.latex.outDir": "%DIR%/out",

        "latex-workshop.latex.tools": [
          {
            "name": "latexmk-xe",
            "command": "latexmk",
            "args": [
              "-synctex=1",
              "-interaction=nonstopmode",
              "-file-line-error",
              "-xelatex",
              "-outdir=%OUTDIR%",
              "%DOC%"
            ]
          }
        ],
        "latex-workshop.latex.recipes": [
          { "name": "latexmk (XeLaTeX)", "tools": ["latexmk-xe"] }
        ],
        "latex-workshop.latex.autoBuild.run": "onSave",
        "latex-workshop.formatting.latex": "latexmk",

        // ----- Python -----
        "editor.formatOnSave": true,

        // ----- General editor prefs -----
        "editor.fontSize": 14,
        "editor.tabSize": 2,
        "files.autoSave": "onFocusChange"
      }
    }
  }
}
